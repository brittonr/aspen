[package]
name = "mvm-ci"
version = "0.1.0"
edition = "2024"

[lib]
name = "mvm_ci"
path = "src/lib.rs"

[features]
default = ["vm-backend", "flawless-backend", "tofu-support"]

# Core features (always enabled implicitly)
# These are the minimum required for basic operation

# Execution backends
vm-backend = []          # Enable VM (Cloud Hypervisor) execution backend
flawless-backend = []     # Enable Flawless WASM runtime backend
local-backend = []        # Enable local process execution backend

# Optional features
tofu-support = []         # Enable OpenTofu/Terraform state backend support
webhook-events = []       # Enable webhook event publishing
metrics = []              # Enable Prometheus metrics export
extended-api = []         # Enable additional API endpoints

# Feature bundles for common use cases
ci-cd = ["vm-backend", "flawless-backend", "tofu-support", "webhook-events"]
batch-processing = ["local-backend", "metrics"]
minimal = []              # Minimal build with only core features

# Development features
test-utils = []           # Enables test utilities (mocks, test factories) for integration tests
debug-logging = []        # Enable verbose debug logging

[[bin]]
name = "mvm-ci"
path = "src/main.rs"

[[bin]]
name = "worker"
path = "src/bin/worker.rs"

[dependencies]
async-trait = "0.1"
module1= { path = "workflows/module1" }
askama = "0.12"
axum = "0.8"
flawless = "1.0.0-beta.3"
flawless-http = "1.0.0-beta.3"
flawless-utils = "1.0.0-beta.3"
iroh = "0.95.1"
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
tokio = { version = "1.48.0", features = ["full"] }
bytes = "1.5"
anyhow = "1.0"
h3-iroh = { path = "./vendor/h3-iroh", features = ["axum"] }
h3 = "0.0.8"
http = "1.0"
iroh-tickets = "0.2"
hiqlite = "0.11.0"
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter"] }
tempfile = "3.8"
chrono = "0.4"
uuid = { version = "1.0", features = ["v4", "serde"] }
urlencoding = "2.1"
num_cpus = "1.16"
hostname = "0.4"
dashmap = "6.1.0"
nix = { version = "0.30.1", features = ["process", "signal"] }
libc = "0.2.177"
regex = "1.12.2"
thiserror = "2.0"

[build-dependencies]
flawless-utils = "1.0.0-beta.3"

[dev-dependencies]
proptest = "1.5"

[workspace]
members = ["workflows/module1"]
# force rebuild 1763830954
# Force rebuild
