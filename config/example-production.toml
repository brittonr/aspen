# Example production configuration for Blixard
# Copy this to config.toml and customize as needed

[network]
http_port = 3020
http_bind_addr = "0.0.0.0"
iroh_alpn = "iroh+h3"

[storage]
iroh_blobs_path = "/var/lib/blixard/iroh-blobs"
hiqlite_data_dir = "/var/lib/blixard/hiqlite"
vm_state_dir = "/var/lib/blixard/vm-state"
work_dir = "/tmp/blixard-work"

[flawless]
flawless_url = "http://localhost:27288"

[vm]
flake_dir = "./microvms"
state_dir = "/var/lib/blixard/firecracker-vms"
default_memory_mb = 1024
default_vcpus = 2
max_concurrent_vms = 20
auto_scaling = true
pre_warm_count = 5

[timing]
worker_no_work_sleep_secs = 2
worker_error_sleep_secs = 5
worker_heartbeat_interval_secs = 30
hiqlite_startup_delay_secs = 3
hiqlite_check_timeout_secs = 60
hiqlite_log_throttle_secs = 5
hiqlite_retry_delay_secs = 1

[timeouts]
vm_startup_timeout_secs = 60
vm_shutdown_timeout_secs = 30
vm_shutdown_retry_delay_millis = 500
vm_health_check_timeout_secs = 10
control_protocol_read_timeout_secs = 5
control_protocol_shutdown_timeout_secs = 10
control_protocol_connect_timeout_secs = 5
iroh_online_timeout_secs = 10
adapter_default_timeout_secs = 300
adapter_wait_timeout_secs = 30
adapter_poll_interval_millis = 500
tofu_plan_timeout_secs = 600

[health_check]
check_interval_secs = 30
check_timeout_secs = 5
failure_threshold = 3
recovery_threshold = 2
enable_circuit_breaker = true
circuit_break_duration_secs = 60

[resource_monitor]
monitor_interval_secs = 10

[adapter]
max_concurrent = 20
max_executions = 100
execution_delay_ms = 100
max_submission_retries = 3
health_check_interval_secs = 30

[job_router]
max_jobs_per_vm = 100
auto_create_vms = true
prefer_service_vms = true

[validation]
job_id_min_length = 1
job_id_max_length = 255
payload_max_size_bytes = 10485760  # 10MB for production

[vm_check]
initial_interval_secs = 1
max_interval_secs = 10
timeout_secs = 300
