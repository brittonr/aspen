[package]
name = "aspen-rpc-core"
version = "0.1.0"
edition = "2024"
description = "Core RPC abstractions for Aspen distributed cluster handlers"
license = "AGPL-3.0-or-later"

[dependencies]
# Core dependencies (always required)
aspen-client-api = { workspace = true }
aspen-constants = { path = "../aspen-constants" }
aspen-core = { path = "../aspen-core" }
aspen-auth = { path = "../aspen-auth" }
aspen-hooks-types = { path = "../aspen-hooks-types" }
aspen-hooks = { path = "../../../aspen-hooks/crates/aspen-hooks", optional = true }
aspen-jobs = { path = "../aspen-jobs", optional = true }
aspen-raft = { path = "../aspen-raft" }
aspen-sharding = { path = "../aspen-sharding" }
aspen-coordination = { path = "../../../aspen-coordination/crates/aspen-coordination" }

# Async/trait support
tokio = { version = "1.0", features = ["sync"] }
async-trait = "0.1"
anyhow = "1.0"
tracing = "0.1"
serde = { workspace = true }

# Plugin registration
inventory = "0.3"

# Optional dependencies (feature-gated)
aspen-blob = { path = "../aspen-blob", optional = true }
aspen-sql = { path = "../aspen-sql", optional = true }
aspen-forge = { path = "../../../aspen-forge/crates/aspen-forge", optional = true }
# Note: aspen-secrets is NOT included here because SecretsService is handler-specific
# and defined in aspen-rpc-handlers. Handler extraction will need trait abstraction.
aspen-ci = { path = "../../../aspen-ci/crates/aspen-ci", optional = true }
aspen-cluster = { path = "../aspen-cluster", optional = true, features = ["federation"] }
aspen-nix-cache-gateway = { path = "../../../aspen-nix/crates/aspen-nix-cache-gateway", optional = true }
aspen-testing = { workspace = true, optional = true }
# Iroh for mock endpoint provider in tests
iroh = { version = "0.95.1", optional = true }

[features]
default = []
sql = ["dep:aspen-sql"]
blob = ["dep:aspen-blob"]
forge = ["dep:aspen-forge", "dep:aspen-cluster"]
# secrets feature removed - SecretsService is handler-specific
ci = ["dep:aspen-ci", "forge"]
# nickel feature enables TriggerService in ci_trigger_service context field
nickel = ["aspen-ci?/nickel"]
nix-cache-gateway = ["dep:aspen-nix-cache-gateway"]
global-discovery = ["aspen-core/global-discovery"]
worker = ["dep:aspen-cluster", "aspen-cluster/jobs"]
jobs = ["dep:aspen-jobs"]
hooks = ["dep:aspen-hooks"]
testing = ["dep:aspen-testing", "dep:iroh"]

[dev-dependencies]
aspen-testing = { workspace = true }
tokio = { version = "1.0", features = ["full", "test-util"] }
