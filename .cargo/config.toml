# Cargo build configuration for Aspen
#
# This file configures build settings for the workspace.

# Allow multiple definitions of zstd symbols when linking.
# This is a workaround for duplicate symbol errors when both zstd-seekable
# (used by libpijul) and zstd-sys (used by aspen-jobs) statically link
# their own copies of the zstd C library.
#
# References:
# - https://github.com/gyscos/zstd-rs/issues/58
# - https://github.com/rust-rocksdb/rust-rocksdb/issues/535

[target.x86_64-unknown-linux-gnu]
linker = "clang"
rustflags = ["-C", "link-arg=-fuse-ld=mold", "-C", "link-arg=-Wl,--allow-multiple-definition"]

[target.aarch64-unknown-linux-gnu]
linker = "clang"
rustflags = ["-C", "link-arg=-fuse-ld=mold", "-C", "link-arg=-Wl,--allow-multiple-definition"]

[target.x86_64-apple-darwin]
rustflags = ["-C", "link-arg=-Wl,-multiply_defined,suppress"]

[target.aarch64-apple-darwin]
rustflags = ["-C", "link-arg=-Wl,-multiply_defined,suppress"]
