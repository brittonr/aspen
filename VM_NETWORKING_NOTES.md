# VM Networking Requirements

## Issue
The microvm-run scripts generated by Nix expect a TAP network interface (`vm-net1`) to exist, but this requires:
1. Root privileges or CAP_NET_ADMIN capability
2. Pre-created tap interface or permission to create one
3. User 'microvm' to exist (for tap ownership)

## Solutions

### Option 1: Run with Network (Production)
```bash
# Create tap interface (requires root)
sudo ip tuntap add name vm-net1 mode tap user $USER
sudo ip link set vm-net1 up

# Then run VM normally
./microvms/result/bin/microvm-run
```

### Option 2: Direct Cloud Hypervisor (Testing)
For testing without network requirements, bypass the microvm-run script and call cloud-hypervisor directly:
```rust
Command::new("/path/to/cloud-hypervisor")
    .args(&[
        "--cpus", "boot=1",
        "--memory", "size=512M",
        "--kernel", kernel_path,
        "--initramfs", initrd_path,
        "--cmdline", "console=hvc0 root=/dev/vda init=/init",
        "--console", "off",
        "--serial", "tty",
        "--api-socket", socket_path
    ])
```

### Option 3: Modify Nix Configuration
Update the microvm.nix flake to make networking optional or to use user-mode networking (slirp) instead of TAP interfaces.

## Test Results
- Cloud Hypervisor VMs start and run successfully without network
- VM control socket API works for management operations
- Database integration (Hiqlite) tracks VM state correctly
- Graceful shutdown works as expected

## Next Steps for Production
1. Set up proper network bridge configuration
2. Create systemd service to manage tap interfaces
3. Consider using macvtap for better performance
4. Implement network namespace isolation for security